---
title: python ç»“åˆ pillow æ¨¡å—ç”Ÿæˆç…§ç‰‡å¢™
date: 2017-11-03 15:11:48
tags: [python]
categories:
top_img: https://blog-1253523830.cosgz.myqcloud.com/assets/img/20190525170527.png
---
## 0x00

æƒ³æŠŠ ins å°å§å§çš„å›¾ç‰‡ç”Ÿæˆç…§ç‰‡å¢™ï¼Ÿ

<!--more-->

## 0x01

- è·å–å›¾ç‰‡

çˆ¬è™«ï¼Ÿæˆ–è€…æ‰‹åŠ¨ä¸€å¼ å¼ ä¸‹è½½ï¼Œæˆ–è€… chrome æ’ä»¶æ‰¹é‡ä¸‹è½½ã€‚

- å®‰è£… pillow æ¨¡å—

```sh
pip(3) install Pillow
```

- 

åœ¨å›¾ç‰‡æ–‡ä»¶å¤¹ä¸‹æ–°å»º python æ–‡ä»¶

```python
# coding=utf-8

import os
from PIL import Image
import logging
import math
from uuid import uuid4

# logger æ—¥å¿—
logger = logging.getLogger()
logger.setLevel(logging.DEBUG)
handler = logging.StreamHandler()
handler.setLevel(logging.DEBUG)
logger.addHandler(handler)


def main(path):
    img_list = os.listdir(path)
    count = len(img_list)
    logger.info(F'å…±æœ‰ {count} å¼ å›¾ç‰‡')
    eachSize = 64  # æ¯å¼ ç…§ç‰‡åƒç´ å¤§å° å¯è‡ªè¡Œè°ƒæ•´
    eachLine = round(math.sqrt(count))
    logger.info(F'å•ä¸ªå›¾åƒè¾¹é•¿ {eachSize} åƒç´ ï¼Œä¸€è¡Œ {eachLine} ä¸ªç…§ç‰‡ï¼Œæœ€ç»ˆå›¾åƒè¾¹é•¿ {eachSize * eachLine}')
    toImage = Image.new('RGBA', (eachSize * eachLine, eachSize * eachLine))  # æ–°å»ºä¸€å—ç”»å¸ƒ
    y = 0
    for x, i in enumerate(img_list):
        try:
            img = Image.open(os.path.join(path, i))  # æ‰“å¼€å›¾ç‰‡
        except IOError:
            logger.info(F"Error: æ²¡æœ‰æ‰¾åˆ°æ–‡ä»¶æˆ–è¯»å–æ–‡ä»¶å¤±è´¥ {os.path.join(path,i)}")
        else:
            img = img.resize((eachSize, eachSize), Image.ANTIALIAS)  # ç¼©å°å›¾ç‰‡
            toImage.paste(img, ((x % eachLine) * eachSize, y * eachSize))  # æ‹¼æ¥å›¾ç‰‡
        # x ä¸ºç´¢å¼•å€¼ ä» 0 å¼€å§‹ æ‰€ä»¥å½“ x + 1 ç­‰äºæ¯è¡Œçš„ç…§ç‰‡ä¸ªæ•°æ—¶ æ¢è¡Œ
        if (x + 1) % eachLine == 0:
            y += 1
    logger.info("ç…§ç‰‡å¢™ç”ŸæˆæˆåŠŸï¼Œæ­£åœ¨ä¿å­˜..")
    # RGBA æ„æ€æ˜¯ çº¢è‰²ï¼Œç»¿è‰²ï¼Œè“è‰²ï¼ŒAlpha çš„è‰²å½©ç©ºé—´ï¼ŒAlphaæŒ‡é€æ˜åº¦ã€‚JPGä¸æ”¯æŒé€æ˜åº¦
    # RGBA ä¿å­˜ä¸º png å¦‚æœä¿å­˜ä¸º jpg ä¼šæŠ›å‡ºå¼‚å¸¸ cannot write mode RGBA as JPEG
    # å¦‚æœè¦ä¿å­˜ä¸º JPEG æˆ–è€… JPG éœ€è¦å°†ç”»å¸ƒæŒ‡å®šä¸º RGB
    filename = os.path.join(os.path.dirname(path), F'{uuid4().hex}.png')
    logger.debug(F'ç…§ç‰‡å¢™æ–‡ä»¶å {filename}')
    toImage.save(filename)  # ä¿å­˜å›¾ç‰‡


if __name__ == "__main__":
    img_path = os.path.join(os.path.dirname(os.path.abspath(__file__)), 'photos')
    logger.info(F'åŸå§‹ç…§ç‰‡æ–‡ä»¶å¤¹è·¯å¾„ {img_path}')
    main(img_path)
```

- ä»£ç åªåœ¨ python3.6 ç‰ˆæœ¬æµ‹è¯•é€šè¿‡

![æœ€ç»ˆæ•ˆæœ](https://blog-1253523830.cosgz.myqcloud.com/assets/img/20190525163325.png)

- ä¹Ÿå¯ä»¥è€ƒè™‘åœ¨æ¯ä¸ªå›¾ç‰‡ä¹‹é—´åŠ ä¸Šé—´è·

```python
toImage = Image.new('RGBA', (eachSize*eachLine+10*eachLine,eachSize*eachLine+10*eachLine))#æ–°å»ºä¸€å—ç”»å¸ƒ 10ä¸ºç…§ç‰‡ä¹‹é—´é—´éš”
toImage.paste(img, (x * (eachSize+10), y * (eachSize+10))) #æ‹¼æ¥å›¾ç‰‡
```

æ•ˆæœå›¾å°±ä¸è´´äº†ã€‚

## 0x02

å‚è€ƒèµ„æ–™ï¼š

[itchat+pillowå®ç°å¾®ä¿¡å¥½å‹å¤´åƒçˆ¬å–å’Œæ‹¼æ¥](https://zhuanlan.zhihu.com/p/25782937)

[Pillow v2.4.0 (PIL fork)](http://pillow-cn.readthedocs.io/zh_CN/latest/reference/Image.html)

[photos by la_lavenda](https://www.instagram.com/la_lavenda/) (å“ï¼ŒğŸ˜©å‘ç°å°å§å§çš„ç…§ç‰‡éƒ½åˆ äº†) ä¾µåˆ 

å°é¢å‡ºå¤„ï¼šhttp://simpledesktops.com/browse/desktops/2017/feb/27/arrow/